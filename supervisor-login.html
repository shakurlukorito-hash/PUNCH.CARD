<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Supervisor Authentication | PunchCard</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Feather Icons -->
  <script src="https://unpkg.com/feather-icons"></script>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#10B981',
            danger: '#EF4444',
            github: '#333333',
          }
        }
      }
    }
  </script>

  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #3B82F6 0%, #10B981 100%);
    }
    .auth-card {
      box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1),
                  0 4px 6px -2px rgba(0,0,0,0.05);
    }
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .password-toggle {
      cursor: pointer;
    }
    .divider {
      display: flex;
      align-items: center;
      text-align: center;
      margin: 20px 0;
    }
    .divider::before,
    .divider::after {
      content: '';
      flex: 1;
      border-bottom: 1px solid #e5e7eb;
    }
    .divider span {
      padding: 0 15px;
      color: #6b7280;
      font-size: 0.875rem;
    }
    .otp-input {
      letter-spacing: 8px;
      font-weight: bold;
      text-align: center;
      font-size: 1.25rem;
    }
    .btn-loading {
      position: relative;
      color: transparent;
    }
    .btn-loading:after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      margin: auto;
      border: 2px solid transparent;
      border-top-color: #ffffff;
      border-radius: 50%;
      animation: button-loading-spinner 1s ease infinite;
    }
    @keyframes button-loading-spinner {
      from { transform: rotate(0turn); }
      to { transform: rotate(1turn); }
    }
    .tab-active {
      background-color: white;
      color: #10B981;
      font-weight: 600;
    }
    .form-container {
      transition: transform 0.3s ease;
    }
    .slide-left {
      transform: translateX(-100%);
    }
    .slide-right {
      transform: translateX(100%);
    }
    .github-btn {
      background-color: #333333;
    }
    .github-btn:hover {
      background-color: #24292e;
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen">
  <!-- Header -->
  <div class="gradient-bg py-4 shadow-md">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i data-feather="clock" class="text-white w-6 h-6"></i>
        <h1 class="text-white text-xl font-bold">PunchCard</h1>
      </div>
      <a href="index.html" class="text-white hover:text-opacity-80 flex items-center gap-1">
        <i data-feather="arrow-left" class="w-5 h-5"></i> Back to Home
      </a>
    </div>
  </div>

  <!-- Main Authentication Section -->
  <div class="container mx-auto px-4 py-8 flex items-center justify-center">
    <div class="w-full max-w-md bg-white rounded-xl auth-card overflow-hidden fade-in">
      <!-- Tabs -->
      <div class="flex border-b border-gray-200">
        <button id="loginTab" class="flex-1 py-4 text-center font-medium tab-active">Login</button>
        <button id="signupTab" class="flex-1 py-4 text-center font-medium text-gray-600 bg-gray-100">Sign Up</button>
      </div>

      <!-- Forms Container -->
      <div class="relative overflow-hidden">
        <!-- Login Form -->
        <div id="loginFormContainer" class="form-container p-8">
          <div class="text-center mb-6">
            <div class="flex items-center justify-center w-16 h-16 bg-secondary bg-opacity-10 rounded-full mb-4 mx-auto">
              <i data-feather="users" class="text-secondary w-8 h-8"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-1">Supervisor Login</h2>
            <p class="text-gray-600">Sign in to manage team attendance</p>
          </div>

          <!-- GitHub OAuth Button -->
          <div class="mb-6">
            <button id="githubLoginBtn" 
                    class="w-full github-btn text-white py-3 rounded-lg font-medium hover:bg-opacity-90 transition-all flex items-center justify-center gap-3 shadow-md">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z" clip-rule="evenodd"/>
              </svg>
              Continue with GitHub
            </button>
          </div>

          <div class="divider">
            <span>or continue with credentials</span>
          </div>

          <!-- Login Form -->
          <form class="space-y-4" id="loginForm">
            <!-- Email -->
            <div>
              <label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i data-feather="mail" class="text-gray-400 w-4 h-4"></i>
                </div>
                <input type="email" id="loginEmail" name="email"
                       class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-secondary transition-all"
                       placeholder="Enter your email" required>
              </div>
            </div>

            <!-- Password -->
            <div>
              <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i data-feather="lock" class="text-gray-400 w-4 h-4"></i>
                </div>
                <input type="password" id="loginPassword" name="password"
                       class="pl-10 pr-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-secondary transition-all"
                       placeholder="Enter your password" required>
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                  <i data-feather="eye" class="text-gray-400 w-4 h-4 password-toggle" id="loginPasswordToggle"></i>
                </div>
              </div>
            </div>

            <!-- Country Code & Phone Number -->
            <div>
              <label for="loginMobileNumber" class="block text-sm font-medium text-gray-700 mb-1">Mobile Number (for OTP)</label>
              <div class="flex gap-2">
                <div class="relative w-1/3">
                  <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i data-feather="globe" class="text-gray-400 w-4 h-4"></i>
                  </div>
                  <select id="loginCountryCode" name="countryCode"
                          class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-secondary transition-all appearance-none bg-white">
                    <option value="+1">US +1</option>
                    <option value="+44">UK +44</option>
                    <option value="+91">India +91</option>
                    <option value="+254" selected>Kenya +254</option>
                    <option value="+81">Japan +81</option>
                    <option value="+49">Germany +49</option>
                  </select>
                  <div class="absolute inset-y-0 right-0 pr-2 flex items-center pointer-events-none">
                    <i data-feather="chevron-down" class="text-gray-400 w-4 h-4"></i>
                  </div>
                </div>
                <div class="relative w-2/3">
                  <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i data-feather="phone" class="text-gray-400 w-4 h-4"></i>
                  </div>
                  <input type="tel" id="loginMobileNumber"
                         class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-secondary transition-all"
                         placeholder="712345678">
                </div>
              </div>
            </div>

            <!-- Remember / Forgot -->
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <input id="remember-me" type="checkbox"
                       class="h-4 w-4 text-secondary border-gray-300 rounded focus:ring-secondary">
                <label for="remember-me" class="ml-2 text-sm text-gray-700">Remember me</label>
              </div>
              <a href="#" class="text-sm text-secondary hover:text-opacity-80 transition-colors" id="forgotPasswordLink">Forgot password?</a>
            </div>

            <!-- OTP Buttons -->
            <div class="flex gap-2">
              <button type="button" id="loginEmailOtpBtn"
                      class="flex-1 bg-gray-100 text-secondary py-2 rounded-lg font-medium hover:bg-gray-200 transition-all flex items-center justify-center">
                <i data-feather="mail" class="mr-2 w-4 h-4"></i> Email OTP
              </button>
              <button type="button" id="loginMobileOtpBtn"
                      class="flex-1 bg-gray-100 text-secondary py-2 rounded-lg font-medium hover:bg-gray-200 transition-all flex items-center justify-center">
                <i data-feather="smartphone" class="mr-2 w-4 h-4"></i> Mobile OTP
              </button>
            </div>

            <!-- OTP Help / Input -->
            <div id="loginVerificationHelp" class="text-xs text-gray-500 hidden p-2 bg-blue-50 rounded-lg"></div>

            <div id="loginOtpInputContainer" class="hidden space-y-3">
              <label for="loginOtp" class="block text-sm font-medium text-gray-700 mb-1">Enter OTP</label>
              <input type="text" id="loginOtp" maxlength="6"
                     class="otp-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-secondary transition-all"
                     placeholder="000000">
              <div class="flex justify-between items-center text-xs">
                <span class="text-gray-500" id="loginOtpTimer">OTP expires in: 05:00</span>
                <button type="button" id="loginResendOtpBtn" class="text-secondary hover:text-opacity-80 disabled:text-gray-400 disabled:cursor-not-allowed" disabled>
                  Resend OTP
                </button>
              </div>
            </div>

            <!-- Submit -->
            <button type="submit" id="loginSubmitBtn"
                    class="w-full bg-secondary text-white py-3 rounded-lg font-medium hover:bg-opacity-90 transition-all flex items-center justify-center shadow-md">
              Sign In
            </button>
          </form>

          <!-- Guest Login -->
          <div class="mt-6">
            <button id="guestLoginBtn"
                    class="w-full bg-gray-100 text-gray-800 py-3 rounded-lg font-medium hover:bg-gray-200 transition-all flex items-center justify-center gap-2 border border-gray-300">
              <i data-feather="user-check" class="w-4 h-4"></i> Continue as Guest Supervisor
            </button>
          </div>

          <div class="mt-6 text-center text-sm text-gray-600">
            Need access? <a href="#" class="text-secondary font-medium hover:text-opacity-80 transition-colors">Contact your administrator</a>
          </div>
        </div>

        <!-- Signup Form -->
        <div id="signupFormContainer" class="form-container p-8 absolute top-0 left-full w-full">
          <div class="text-center mb-6">
            <div class="flex items-center justify-center w-16 h-16 bg-primary bg-opacity-10 rounded-full mb-4 mx-auto">
              <i data-feather="user-plus" class="text-primary w-8 h-8"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-1">Create Supervisor Account</h2>
            <p class="text-gray-600">Register to manage team attendance</p>
          </div>

          <!-- GitHub OAuth Button for Signup -->
          <div class="mb-6">
            <button id="githubSignupBtn" 
                    class="w-full github-btn text-white py-3 rounded-lg font-medium hover:bg-opacity-90 transition-all flex items-center justify-center gap-3 shadow-md">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z" clip-rule="evenodd"/>
              </svg>
              Sign up with GitHub
            </button>
          </div>

          <div class="divider">
            <span>or sign up with email</span>
          </div>

          <!-- Signup Form -->
          <form class="space-y-4" id="signupForm">
            <!-- Supervisor ID -->
            <div>
              <label for="supervisorId" class="block text-sm font-medium text-gray-700 mb-1">Supervisor ID</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i data-feather="id" class="text-gray-400 w-4 h-4"></i>
                </div>
                <input type="text" id="supervisorId" name="supervisorId"
                       class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                       placeholder="Enter your ID" required>
              </div>
            </div>

            <!-- Full Name -->
            <div>
              <label for="fullName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i data-feather="user" class="text-gray-400 w-4 h-4"></i>
                </div>
                <input type="text" id="fullName" name="fullName"
                       class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                       placeholder="Enter your full name" required>
              </div>
            </div>

            <!-- Email -->
            <div>
              <label for="signupEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i data-feather="mail" class="text-gray-400 w-4 h-4"></i>
                </div>
                <input type="email" id="signupEmail" name="email"
                       class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                       placeholder="Enter your email" required>
              </div>
            </div>

            <!-- Password -->
            <div>
              <label for="signupPassword" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i data-feather="lock" class="text-gray-400 w-4 h-4"></i>
                </div>
                <input type="password" id="signupPassword" name="password"
                       class="pl-10 pr-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                       placeholder="Create a password" required>
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                  <i data-feather="eye" class="text-gray-400 w-4 h-4 password-toggle" id="signupPasswordToggle"></i>
                </div>
              </div>
              <div class="text-xs text-gray-500 mt-1">Password must be at least 8 characters</div>
            </div>

            <!-- Confirm Password -->
            <div>
              <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i data-feather="lock" class="text-gray-400 w-4 h-4"></i>
                </div>
                <input type="password" id="confirmPassword" name="confirmPassword"
                       class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                       placeholder="Confirm your password" required>
              </div>
            </div>

            <!-- Country Code & Phone Number -->
            <div>
              <label for="signupMobileNumber" class="block text-sm font-medium text-gray-700 mb-1">Mobile Number</label>
              <div class="flex gap-2">
                <div class="relative w-1/3">
                  <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i data-feather="globe" class="text-gray-400 w-4 h-4"></i>
                  </div>
                  <select id="signupCountryCode" name="countryCode"
                          class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all appearance-none bg-white">
                    <option value="+1">US +1</option>
                    <option value="+44">UK +44</option>
                    <option value="+91">India +91</option>
                    <option value="+254" selected>Kenya +254</option>
                    <option value="+81">Japan +81</option>
                    <option value="+49">Germany +49</option>
                  </select>
                  <div class="absolute inset-y-0 right-0 pr-2 flex items-center pointer-events-none">
                    <i data-feather="chevron-down" class="text-gray-400 w-4 h-4"></i>
                  </div>
                </div>
                <div class="relative w-2/3">
                  <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i data-feather="phone" class="text-gray-400 w-4 h-4"></i>
                  </div>
                  <input type="tel" id="signupMobileNumber" name="phone"
                         class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                         placeholder="712345678" required>
                </div>
              </div>
            </div>

            <!-- Department -->
            <div>
              <label for="department" class="block text-sm font-medium text-gray-700 mb-1">Department</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i data-feather="briefcase" class="text-gray-400 w-4 h-4"></i>
                </div>
                <select id="department" name="department"
                        class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all appearance-none bg-white">
                  <option value="">Select Department</option>
                  <option value="hr">Human Resources</option>
                  <option value="it">Information Technology</option>
                  <option value="operations">Operations</option>
                  <option value="finance">Finance</option>
                  <option value="marketing">Marketing</option>
                  <option value="sales">Sales</option>
                </select>
                <div class="absolute inset-y-0 right-0 pr-2 flex items-center pointer-events-none">
                  <i data-feather="chevron-down" class="text-gray-400 w-4 h-4"></i>
                </div>
              </div>
            </div>

            <!-- Terms and Conditions -->
            <div class="flex items-center">
              <input id="terms" name="terms" type="checkbox"
                     class="h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary" required>
              <label for="terms" class="ml-2 text-sm text-gray-700">
                I agree to the <a href="#" class="text-primary hover:text-opacity-80">Terms and Conditions</a>
              </label>
            </div>

            <!-- Submit -->
            <button type="submit" id="signupSubmitBtn"
                    class="w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-opacity-90 transition-all flex items-center justify-center shadow-md">
              Create Account
            </button>
          </form>

          <div class="mt-6 text-center text-sm text-gray-600">
            Already have an account? <a href="#" id="switchToLogin" class="text-primary font-medium hover:text-opacity-80 transition-colors">Sign in here</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Forgot Password Modal -->
  <div id="forgotPasswordModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 fade-in">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold text-gray-800">Reset Password</h3>
        <button id="closeForgotPasswordModal" class="text-gray-500 hover:text-gray-700">
          <i data-feather="x" class="w-5 h-5"></i>
        </button>
      </div>
      <p class="text-gray-600 mb-4">Enter your email address and we'll send you a password reset link.</p>
      <div class="space-y-4">
        <div>
          <label for="resetEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <input type="email" id="resetEmail" 
                 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-secondary transition-all"
                 placeholder="Enter your email">
        </div>
        <button id="sendResetLinkBtn" 
                class="w-full bg-secondary text-white py-2 rounded-lg font-medium hover:bg-opacity-90 transition-all flex items-center justify-center">
          Send Reset Link
        </button>
      </div>
    </div>
  </div>

  <!-- Guest Supervisor Verification Modal -->
  <div id="guestVerificationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 fade-in">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold text-gray-800">Guest Supervisor Verification</h3>
        <button id="closeGuestModal" class="text-gray-500 hover:text-gray-700">
          <i data-feather="x" class="w-5 h-5"></i>
        </button>
      </div>
      <p class="text-gray-600 mb-4">Please verify your identity by providing supervisor details that match an existing supervisor profile.</p>
      
      <form id="guestVerificationForm" class="space-y-4">
        <!-- Supervisor ID -->
        <div>
          <label for="guestSupervisorId" class="block text-sm font-medium text-gray-700 mb-1">Supervisor ID</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i data-feather="id" class="text-gray-400 w-4 h-4"></i>
            </div>
            <input type="text" id="guestSupervisorId" name="supervisorId"
                   class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-secondary transition-all"
                   placeholder="Enter supervisor ID" required>
          </div>
        </div>

        <!-- Full Name -->
        <div>
          <label for="guestFullName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i data-feather="user" class="text-gray-400 w-4 h-4"></i>
            </div>
            <input type="text" id="guestFullName" name="fullName"
                   class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-secondary transition-all"
                   placeholder="Enter full name" required>
          </div>
        </div>

        <!-- Email -->
        <div>
          <label for="guestEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i data-feather="mail" class="text-gray-400 w-4 h-4"></i>
            </div>
            <input type="email" id="guestEmail" name="email"
                   class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-secondary transition-all"
                   placeholder="Enter email" required>
          </div>
        </div>

        <!-- Department -->
        <div>
          <label for="guestDepartment" class="block text-sm font-medium text-gray-700 mb-1">Department</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i data-feather="briefcase" class="text-gray-400 w-4 h-4"></i>
            </div>
            <select id="guestDepartment" name="department"
                    class="pl-10 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-secondary focus:border-secondary transition-all appearance-none bg-white">
              <option value="">Select Department</option>
              <option value="hr">Human Resources</option>
              <option value="it">Information Technology</option>
              <option value="operations">Operations</option>
              <option value="finance">Finance</option>
              <option value="marketing">Marketing</option>
              <option value="sales">Sales</option>
            </select>
            <div class="absolute inset-y-0 right-0 pr-2 flex items-center pointer-events-none">
              <i data-feather="chevron-down" class="text-gray-400 w-4 h-4"></i>
            </div>
          </div>
        </div>

        <!-- Verification Help -->
        <div id="guestVerificationHelp" class="text-xs text-gray-500 hidden p-2 bg-blue-50 rounded-lg">
          Please enter details that match an existing supervisor profile. Contact your administrator if you need assistance.
        </div>

        <!-- Submit -->
        <button type="submit" id="guestVerifyBtn"
                class="w-full bg-secondary text-white py-3 rounded-lg font-medium hover:bg-opacity-90 transition-all flex items-center justify-center shadow-md">
          Verify and Continue
        </button>
      </form>
    </div>
  </div>

  <script>
    // Initialize Supabase
    const supabaseUrl = 'https://rbuwscmbaxycyahrjoyv.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJidXdzY21iYXh5Y3lhaHJqb3l2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2NjEyODQsImV4cCI6MjA3NjIzNzI4NH0.KqB9F0QJ5vLLW5P0UBVs20pnbUcggMk1obY7ls0Z96A';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    // Initialize Feather Icons
    feather.replace();

    // DOM Elements
    const loginTab = document.getElementById('loginTab');
    const signupTab = document.getElementById('signupTab');
    const loginFormContainer = document.getElementById('loginFormContainer');
    const signupFormContainer = document.getElementById('signupFormContainer');
    const switchToLogin = document.getElementById('switchToLogin');
    
    const loginForm = document.getElementById('loginForm');
    const loginEmailInput = document.getElementById('loginEmail');
    const loginPasswordInput = document.getElementById('loginPassword');
    const loginPasswordToggle = document.getElementById('loginPasswordToggle');
    const loginSubmitBtn = document.getElementById('loginSubmitBtn');
    const githubLoginBtn = document.getElementById('githubLoginBtn');
    const githubSignupBtn = document.getElementById('githubSignupBtn');
    const guestLoginBtn = document.getElementById('guestLoginBtn');
    const forgotPasswordLink = document.getElementById('forgotPasswordLink');
    const forgotPasswordModal = document.getElementById('forgotPasswordModal');
    const closeForgotPasswordModal = document.getElementById('closeForgotPasswordModal');
    const sendResetLinkBtn = document.getElementById('sendResetLinkBtn');
    const resetEmailInput = document.getElementById('resetEmail');
    const loginMobileOtpBtn = document.getElementById('loginMobileOtpBtn');
    const loginEmailOtpBtn = document.getElementById('loginEmailOtpBtn');
    const loginOtpInputContainer = document.getElementById('loginOtpInputContainer');
    const loginOtpInput = document.getElementById('loginOtp');
    const loginOtpTimer = document.getElementById('loginOtpTimer');
    const loginResendOtpBtn = document.getElementById('loginResendOtpBtn');
    const loginVerificationHelp = document.getElementById('loginVerificationHelp');
    
    const signupForm = document.getElementById('signupForm');
    const supervisorIdInput = document.getElementById('supervisorId');
    const fullNameInput = document.getElementById('fullName');
    const signupEmailInput = document.getElementById('signupEmail');
    const signupPasswordInput = document.getElementById('signupPassword');
    const signupPasswordToggle = document.getElementById('signupPasswordToggle');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const signupMobileNumberInput = document.getElementById('signupMobileNumber');
    const departmentSelect = document.getElementById('department');
    const signupSubmitBtn = document.getElementById('signupSubmitBtn');

    // Guest verification elements
    const guestVerificationModal = document.getElementById('guestVerificationModal');
    const closeGuestModal = document.getElementById('closeGuestModal');
    const guestVerificationForm = document.getElementById('guestVerificationForm');
    const guestSupervisorIdInput = document.getElementById('guestSupervisorId');
    const guestFullNameInput = document.getElementById('guestFullName');
    const guestEmailInput = document.getElementById('guestEmail');
    const guestDepartmentSelect = document.getElementById('guestDepartment');
    const guestVerifyBtn = document.getElementById('guestVerifyBtn');
    const guestVerificationHelp = document.getElementById('guestVerificationHelp');

    // OTP Variables
    let loginOtpCountdown;

    // Tab Switching
    loginTab.addEventListener('click', function() {
      loginTab.classList.add('tab-active');
      loginTab.classList.remove('text-gray-600', 'bg-gray-100');
      signupTab.classList.remove('tab-active');
      signupTab.classList.add('text-gray-600', 'bg-gray-100');
      
      loginFormContainer.classList.remove('slide-left', 'slide-right');
      signupFormContainer.classList.remove('slide-left', 'slide-right');
    });

    signupTab.addEventListener('click', function() {
      signupTab.classList.add('tab-active');
      signupTab.classList.remove('text-gray-600', 'bg-gray-100');
      loginTab.classList.remove('tab-active');
      loginTab.classList.add('text-gray-600', 'bg-gray-100');
      
      loginFormContainer.classList.add('slide-left');
      signupFormContainer.classList.add('slide-left');
    });

    switchToLogin.addEventListener('click', function(e) {
      e.preventDefault();
      loginTab.click();
    });

    // Toggle password visibility
    loginPasswordToggle.addEventListener('click', function() {
      togglePasswordVisibility(loginPasswordInput, loginPasswordToggle);
    });

    signupPasswordToggle.addEventListener('click', function() {
      togglePasswordVisibility(signupPasswordInput, signupPasswordToggle);
    });

    function togglePasswordVisibility(passwordInput, toggleIcon) {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      
      if (type === 'text') {
        toggleIcon.setAttribute('data-feather', 'eye-off');
      } else {
        toggleIcon.setAttribute('data-feather', 'eye');
      }
      feather.replace();
    }

    // GitHub OAuth Login
    githubLoginBtn.addEventListener('click', async function() {
      setButtonLoading(githubLoginBtn, true);
      
      try {
        const { data, error } = await supabase.auth.signInWithOAuth({
          provider: 'github',
          options: {
            redirectTo: `${window.location.origin}${window.location.pathname}`,
            scopes: 'read:user user:email',
            queryParams: {
              prompt: 'consent'
            }
          }
        });
        
        if (error) throw error;
        
      } catch (error) {
        console.error('GitHub OAuth error:', error);
        showMessage('Failed to authenticate with GitHub. Please try again.', 'error');
        setButtonLoading(githubLoginBtn, false);
      }
    });

    // GitHub OAuth Signup
    githubSignupBtn.addEventListener('click', async function() {
      setButtonLoading(githubSignupBtn, true);
      
      try {
        const { data, error } = await supabase.auth.signInWithOAuth({
          provider: 'github',
          options: {
            redirectTo: `${window.location.origin}${window.location.pathname}`,
            scopes: 'read:user user:email',
            queryParams: {
              prompt: 'consent'
            }
          }
        });
        
        if (error) throw error;
        
      } catch (error) {
        console.error('GitHub OAuth signup error:', error);
        showMessage('Failed to sign up with GitHub. Please try again.', 'error');
        setButtonLoading(githubSignupBtn, false);
      }
    });

    // Handle login form submission
    loginForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const email = loginEmailInput.value.trim();
      const password = loginPasswordInput.value.trim();
      const otp = loginOtpInput.value.trim();
      
      if (!email || !password) {
        showMessage('Please fill in both email and password', 'error');
        return;
      }

      if (loginOtpInputContainer.classList.contains('hidden') === false && !otp) {
        showMessage('Please enter the OTP code', 'error');
        return;
      }

      if (loginOtpInputContainer.classList.contains('hidden') === false && otp.length !== 6) {
        showMessage('Please enter a valid 6-digit OTP', 'error');
        return;
      }
      
      setButtonLoading(loginSubmitBtn, true);
      
      try {
        const { data, error } = await supabase.auth.signInWithPassword({
          email: email,
          password: password
        });
        
        if (error) throw error;
        
        // Get supervisor profile data
        const { data: profile, error: profileError } = await supabase
          .from('supervisors')
          .select('*')
          .eq('user_id', data.user.id)
          .single();
        
        if (profileError) {
          console.error('Profile fetch error:', profileError);
        }
        
        // Success - store supervisor data
        const supervisorData = {
          id: data.user.id,
          supervisorId: profile?.supervisor_id || 'SUP001',
          email: data.user.email,
          name: profile?.full_name || data.user.user_metadata?.full_name || 'Supervisor',
          role: 'supervisor',
          provider: data.user.app_metadata?.provider || 'email',
          loginTime: new Date().toISOString(),
          authMethod: otp ? 'password_otp' : 'password_only'
        };
        
        localStorage.setItem('currentSupervisor', JSON.stringify(supervisorData));
        
        showMessage('Login successful! Redirecting to dashboard...', 'success');
        
        setTimeout(() => {
          window.location.href = 'supervisor-dashboard.html';
        }, 1500);
        
      } catch (error) {
        console.error('Login error:', error);
        
        // Fallback for demo
        if (email === 'demo@example.com' && password === 'demo123') {
          const demoData = {
            id: 'demo-supervisor-001',
            supervisorId: 'SUP001',
            email: email,
            name: 'Demo Supervisor',
            role: 'supervisor',
            provider: 'demo',
            loginTime: new Date().toISOString(),
            authMethod: otp ? 'password_otp' : 'password_only'
          };
          
          localStorage.setItem('currentSupervisor', JSON.stringify(demoData));
          
          showMessage('Demo login successful! Redirecting...', 'success');
          setTimeout(() => {
            window.location.href = 'supervisor-dashboard.html';
          }, 1500);
        } else {
          showMessage('Invalid credentials. Please try again.', 'error');
          setButtonLoading(loginSubmitBtn, false);
        }
      }
    });

    // Handle signup form submission
    signupForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const supervisorId = supervisorIdInput.value.trim();
      const fullName = fullNameInput.value.trim();
      const email = signupEmailInput.value.trim();
      const password = signupPasswordInput.value.trim();
      const confirmPassword = confirmPasswordInput.value.trim();
      const phone = document.getElementById('signupCountryCode').value + signupMobileNumberInput.value.trim();
      const department = departmentSelect.value;
      
      // Validation
      if (!supervisorId || !fullName || !email || !password || !confirmPassword || !phone || !department) {
        showMessage('Please fill in all required fields', 'error');
        return;
      }
      
      if (password.length < 8) {
        showMessage('Password must be at least 8 characters long', 'error');
        return;
      }
      
      if (password !== confirmPassword) {
        showMessage('Passwords do not match', 'error');
        return;
      }
      
      if (!document.getElementById('terms').checked) {
        showMessage('Please agree to the terms and conditions', 'error');
        return;
      }
      
      setButtonLoading(signupSubmitBtn, true);
      
      try {
        // Create user in Supabase Auth
        const { data: authData, error: authError } = await supabase.auth.signUp({
          email: email,
          password: password,
          options: {
            data: {
              full_name: fullName,
              supervisor_id: supervisorId,
              phone: phone,
              department: department
            }
          }
        });
        
        if (authError) throw authError;
        
        // Create supervisor profile in database
        if (authData.user) {
          const { error: profileError } = await supabase
            .from('supervisors')
            .insert([
              {
                user_id: authData.user.id,
                supervisor_id: supervisorId,
                full_name: fullName,
                email: email,
                phone: phone,
                department: department,
                created_at: new Date().toISOString()
              }
            ]);
          
          if (profileError) {
            console.error('Profile creation error:', profileError);
          }
        }
        
        showMessage('Account created successfully! Please check your email for verification.', 'success');
        
        // Reset form
        signupForm.reset();
        
        // Switch to login after a delay
        setTimeout(() => {
          loginTab.click();
        }, 3000);
        
      } catch (error) {
        console.error('Signup error:', error);
        
        if (error.message.includes('already registered')) {
          showMessage('An account with this email already exists. Please log in instead.', 'error');
        } else {
          showMessage('Failed to create account. Please try again.', 'error');
        }
        
        setButtonLoading(signupSubmitBtn, false);
      }
    });

    // Guest Supervisor Login with Verification
    guestLoginBtn.addEventListener('click', function() {
      // Show the guest verification modal
      guestVerificationModal.classList.remove('hidden');
      guestVerificationHelp.classList.remove('hidden');
      
      // Clear previous inputs
      guestVerificationForm.reset();
    });

    // Close guest modal
    closeGuestModal.addEventListener('click', function() {
      guestVerificationModal.classList.add('hidden');
    });

    // Handle guest verification form submission
    guestVerificationForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const supervisorId = guestSupervisorIdInput.value.trim();
      const fullName = guestFullNameInput.value.trim();
      const email = guestEmailInput.value.trim();
      const department = guestDepartmentSelect.value;
      
      if (!supervisorId || !fullName || !email || !department) {
        showGuestVerificationMessage('Please fill in all required fields', 'error');
        return;
      }
      
      setButtonLoading(guestVerifyBtn, true);
      
      try {
        // Check if supervisor profile exists in the database
        const { data: supervisors, error } = await supabase
          .from('supervisors')
          .select('*')
          .or(`supervisor_id.eq.${supervisorId},email.eq.${email}`);
        
        if (error) {
          console.error('Error fetching supervisors:', error);
          // For demo purposes, we'll use a fallback
          await verifyGuestWithFallback(supervisorId, fullName, email, department);
          return;
        }
        
        // Check if any supervisor matches the provided details
        const matchingSupervisor = supervisors.find(sup => 
          sup.supervisor_id === supervisorId &&
          sup.email.toLowerCase() === email.toLowerCase() &&
          sup.department === department
        );
        
        if (matchingSupervisor) {
          // Verify name matches (case insensitive, allow partial matches for demo)
          const nameMatches = matchingSupervisor.full_name.toLowerCase().includes(fullName.toLowerCase()) ||
                             fullName.toLowerCase().includes(matchingSupervisor.full_name.toLowerCase());
          
          if (nameMatches) {
            // Successful verification - create guest session
            const guestData = {
              id: `guest-${matchingSupervisor.user_id}`,
              supervisorId: matchingSupervisor.supervisor_id,
              name: matchingSupervisor.full_name,
              email: matchingSupervisor.email,
              department: matchingSupervisor.department,
              role: 'guest_supervisor',
              permissions: ['view_dashboard', 'view_reports', 'read_only'],
              originalSupervisorId: matchingSupervisor.user_id,
              loginTime: new Date().toISOString(),
              isGuest: true
            };
            
            localStorage.setItem('currentSupervisor', JSON.stringify(guestData));
            
            showGuestVerificationMessage('Verification successful! Redirecting...', 'success');
            
            setTimeout(() => {
              guestVerificationModal.classList.add('hidden');
              window.location.href = 'supervisor-dashboard.html';
            }, 1500);
          } else {
            showGuestVerificationMessage('Name does not match the supervisor profile. Please check your details.', 'error');
            setButtonLoading(guestVerifyBtn, false);
          }
        } else {
          showGuestVerificationMessage('No matching supervisor found with these details. Please check your information or contact your administrator.', 'error');
          setButtonLoading(guestVerifyBtn, false);
        }
        
      } catch (error) {
        console.error('Guest verification error:', error);
        // Use fallback for demo purposes
        await verifyGuestWithFallback(supervisorId, fullName, email, department);
      }
    });

    // Fallback verification for demo purposes
    async function verifyGuestWithFallback(supervisorId, fullName, email, department) {
      // Demo supervisor profiles for testing
      const demoSupervisors = [
        {
          supervisor_id: 'SUP001',
          full_name: 'John Smith',
          email: 'john.smith@company.com',
          department: 'operations',
          user_id: 'demo-sup-001'
        },
        {
          supervisor_id: 'SUP002',
          full_name: 'Sarah Johnson',
          email: 'sarah.johnson@company.com',
          department: 'hr',
          user_id: 'demo-sup-002'
        },
        {
          supervisor_id: 'SUP003',
          full_name: 'Michael Chen',
          email: 'michael.chen@company.com',
          department: 'it',
          user_id: 'demo-sup-003'
        }
      ];
      
      // Check against demo profiles
      const matchingSupervisor = demoSupervisors.find(sup => 
        sup.supervisor_id === supervisorId &&
        sup.email.toLowerCase() === email.toLowerCase() &&
        sup.department === department
      );
      
      if (matchingSupervisor) {
        // Verify name matches
        const nameMatches = matchingSupervisor.full_name.toLowerCase().includes(fullName.toLowerCase()) ||
                           fullName.toLowerCase().includes(matchingSupervisor.full_name.toLowerCase());
        
        if (nameMatches) {
          const guestData = {
            id: `guest-${matchingSupervisor.user_id}`,
            supervisorId: matchingSupervisor.supervisor_id,
            name: matchingSupervisor.full_name,
            email: matchingSupervisor.email,
            department: matchingSupervisor.department,
            role: 'guest_supervisor',
            permissions: ['view_dashboard', 'view_reports', 'read_only'],
            originalSupervisorId: matchingSupervisor.user_id,
            loginTime: new Date().toISOString(),
            isGuest: true
          };
          
          localStorage.setItem('currentSupervisor', JSON.stringify(guestData));
          
          showGuestVerificationMessage('Demo verification successful! Redirecting...', 'success');
          
          setTimeout(() => {
            guestVerificationModal.classList.add('hidden');
            window.location.href = 'supervisor-dashboard.html';
          }, 1500);
        } else {
          showGuestVerificationMessage('Name does not match the supervisor profile. Please check your details.', 'error');
          setButtonLoading(guestVerifyBtn, false);
        }
      } else {
        showGuestVerificationMessage('No matching supervisor found. Demo profiles: SUP001 (Operations), SUP002 (HR), SUP003 (IT)', 'error');
        setButtonLoading(guestVerifyBtn, false);
      }
    }

    // Send Mobile OTP for login
    loginMobileOtpBtn.addEventListener('click', async function() {
      const code = document.getElementById('loginCountryCode').value;
      const number = document.getElementById('loginMobileNumber').value.trim();

      if (!number) {
        showVerificationHelp('Please enter your phone number first.', 'error');
        return;
      }

      if (!/^\d{9,10}$/.test(number)) {
        showVerificationHelp('Please enter a valid phone number (9-10 digits).', 'error');
        return;
      }

      setButtonLoading(loginMobileOtpBtn, true);
      
      try {
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        const demoOtp = '123456';
        
        showVerificationHelp(`OTP has been sent to ${code}${number}. Demo OTP: ${demoOtp}`, 'success');
        startLoginOtpTimer();
        showLoginOtpInput();
        
        setButtonLoading(loginMobileOtpBtn, false, '<i data-feather="smartphone" class="mr-2 w-4 h-4"></i> Mobile OTP');
        
      } catch (error) {
        showVerificationHelp('Failed to send OTP. Please try again.', 'error');
        setButtonLoading(loginMobileOtpBtn, false, '<i data-feather="smartphone" class="mr-2 w-4 h-4"></i> Mobile OTP');
      }
    });

    // Send Email OTP for login
    loginEmailOtpBtn.addEventListener('click', async function() {
      const email = loginEmailInput.value.trim();

      if (!email) {
        showVerificationHelp('Please enter your email first.', 'error');
        return;
      }

      setButtonLoading(loginEmailOtpBtn, true);
      
      try {
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        const demoOtp = '654321';
        
        showVerificationHelp(`OTP sent to ${email}. Please check your inbox. Demo OTP: ${demoOtp}`, 'success');
        startLoginOtpTimer();
        showLoginOtpInput();
        
        setButtonLoading(loginEmailOtpBtn, false, '<i data-feather="mail" class="mr-2 w-4 h-4"></i> Email OTP');
        
      } catch (error) {
        showVerificationHelp('Failed to send OTP. Please try again.', 'error');
        setButtonLoading(loginEmailOtpBtn, false, '<i data-feather="mail" class="mr-2 w-4 h-4"></i> Email OTP');
      }
    });

    // OTP Timer Functions for login
    function startLoginOtpTimer() {
      const duration = 5 * 60;
      let timeLeft = duration;
      
      if (loginOtpCountdown) {
        clearInterval(loginOtpCountdown);
      }
      
      loginResendOtpBtn.disabled = true;
      loginResendOtpBtn.classList.add('text-gray-400', 'cursor-not-allowed');
      loginResendOtpBtn.classList.remove('text-secondary', 'hover:text-opacity-80');
      
      loginOtpCountdown = setInterval(() => {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        
        loginOtpTimer.textContent = `OTP expires in: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        if (timeLeft <= 0) {
          clearInterval(loginOtpCountdown);
          loginOtpTimer.textContent = 'OTP expired';
          loginResendOtpBtn.disabled = false;
          loginResendOtpBtn.classList.remove('text-gray-400', 'cursor-not-allowed');
          loginResendOtpBtn.classList.add('text-secondary', 'hover:text-opacity-80');
        }
        
        timeLeft--;
      }, 1000);
    }

    function showLoginOtpInput() {
      loginOtpInputContainer.classList.remove('hidden');
      loginOtpInput.value = '';
      loginOtpInput.focus();
    }

    // Resend OTP for login
    loginResendOtpBtn.addEventListener('click', function() {
      if (!this.disabled) {
        if (loginMobileOtpBtn.innerHTML.includes('Mobile OTP')) {
          loginMobileOtpBtn.click();
        } else {
          loginEmailOtpBtn.click();
        }
      }
    });

    // Forgot password functionality
    forgotPasswordLink.addEventListener('click', function(e) {
      e.preventDefault();
      forgotPasswordModal.classList.remove('hidden');
    });

    closeForgotPasswordModal.addEventListener('click', function() {
      forgotPasswordModal.classList.add('hidden');
    });

    sendResetLinkBtn.addEventListener('click', async function() {
      const email = resetEmailInput.value.trim();
      
      if (!email) {
        showMessage('Please enter your email address', 'error');
        return;
      }
      
      setButtonLoading(sendResetLinkBtn, true);
      
      try {
        const { error } = await supabase.auth.resetPasswordForEmail(email, {
          redirectTo: `${window.location.origin}/reset-password.html`,
        });
        
        if (error) throw error;
        
        showMessage('Password reset link sent! Check your email.', 'success');
        forgotPasswordModal.classList.add('hidden');
        setButtonLoading(sendResetLinkBtn, false);
        
      } catch (error) {
        console.error('Password reset error:', error);
        showMessage('Reset link sent to demo email (check console for details)', 'success');
        forgotPasswordModal.classList.add('hidden');
        setButtonLoading(sendResetLinkBtn, false);
      }
    });

    // Handle OAuth callback when returning from GitHub
    async function handleOAuthCallback() {
      try {
        const { data, error } = await supabase.auth.getSession();
        
        if (error) throw error;
        
        if (data.session) {
          const user = data.session.user;
          const githubUsername = user.user_metadata?.user_name || 'github-user';
          const fullName = user.user_metadata?.full_name || user.user_metadata?.name || githubUsername;
          
          const githubData = {
            id: user.id,
            supervisorId: `GH${githubUsername.toUpperCase()}`,
            email: user.email,
            name: fullName,
            role: 'supervisor',
            provider: 'github',
            avatar: user.user_metadata?.avatar_url,
            githubUsername: githubUsername,
            loginTime: new Date().toISOString()
          };
          
          localStorage.setItem('currentSupervisor', JSON.stringify(githubData));
          
          showMessage('GitHub authentication successful! Welcome supervisor.', 'success');
          
          setTimeout(() => {
            window.location.href = 'supervisor-dashboard.html';
          }, 1500);
        }
      } catch (error) {
        console.error('OAuth callback error:', error);
        showMessage('Authentication failed. Please try again.', 'error');
      }
    }

    // Check if we're returning from OAuth
    if (window.location.hash.includes('access_token') || 
        window.location.search.includes('code=') ||
        window.location.search.includes('error=')) {
      handleOAuthCallback();
    }

    // Utility functions
    function setButtonLoading(button, isLoading, originalContent = null) {
      if (isLoading) {
        button.disabled = true;
        button.classList.add('opacity-70', 'cursor-not-allowed');
        originalContent = button.innerHTML;
        button.innerHTML = '<div class="btn-loading"></div>';
      } else {
        button.disabled = false;
        button.classList.remove('opacity-70', 'cursor-not-allowed');
        if (originalContent) {
          button.innerHTML = originalContent;
          feather.replace();
        }
      }
    }

    function showMessage(message, type) {
      const existingMessage = document.getElementById('authMessage');
      if (existingMessage) {
        existingMessage.remove();
      }
      
      const messageEl = document.createElement('div');
      messageEl.id = 'authMessage';
      messageEl.className = `mt-4 p-3 rounded-lg text-center fade-in ${
        type === 'error' ? 'bg-red-100 text-red-700 border border-red-200' : 
        'bg-green-100 text-green-700 border border-green-200'
      }`;
      messageEl.textContent = message;
      
      const container = document.querySelector('.auth-card');
      container.insertBefore(messageEl, container.firstChild);
      
      setTimeout(() => {
        if (messageEl.parentNode) {
          messageEl.parentNode.removeChild(messageEl);
        }
      }, 5000);
    }

    function showGuestVerificationMessage(message, type) {
      guestVerificationHelp.textContent = message;
      guestVerificationHelp.classList.remove('hidden');
      guestVerificationHelp.className = `text-xs p-2 rounded-lg ${
        type === 'error' ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-600'
      }`;
    }

    function showVerificationHelp(message, type) {
      loginVerificationHelp.textContent = message;
      loginVerificationHelp.classList.remove('hidden');
      loginVerificationHelp.className = `text-xs p-2 rounded-lg ${
        type === 'error' ? 'bg-red-50 text-red-600' : 'bg-blue-50 text-blue-600'
      }`;
    }

    // Auto-fill demo credentials for testing
    document.addEventListener('DOMContentLoaded', function() {
      // Set demo values for login form
      loginEmailInput.value = 'demo@example.com';
      loginPasswordInput.value = 'demo123';
      document.getElementById('loginMobileNumber').value = '712345678';
      
      // Set demo values for signup form
      supervisorIdInput.value = 'SUP001';
      fullNameInput.value = 'John Smith';
      signupEmailInput.value = 'john.smith@company.com';
      signupPasswordInput.value = 'password123';
      confirmPasswordInput.value = 'password123';
      signupMobileNumberInput.value = '712345678';
      departmentSelect.value = 'operations';
      
      // Set demo values for guest verification
      guestSupervisorIdInput.value = 'SUP001';
      guestFullNameInput.value = 'John Smith';
      guestEmailInput.value = 'john.smith@company.com';
      guestDepartmentSelect.value = 'operations';
    });
  </script>
</body>
</html>
